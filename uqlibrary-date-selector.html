<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../core-icons/core-icons.html">

<link rel="import" href="uqlibrary-time-selector.html">

<!--

Custom web element displays a provided date and time schedule with ability to select time slots

##### Example

    <uqlibrary-date-selector></uqlibrary-date-selector>

     <script>
      (function () {

        window.addEventListener('polymer-ready', function() {
            var date_selector = document.querySelector('uqlibrary-date-selector');

            date_selector.searchDate = new Date(new Date().getTime() + 2 * 24 * 60 * 60 * 1000);
            date_selector.maxBookingDate = new Date(new Date().getTime() + 7 * 24 * 60 * 60 * 1000);
            date_selector.bookingTimeslots = [
                {
                    startTime : '8:00 am',
                    selectable: true,
                    selected: false
                },
                {
                    startTime : '8:30 am',
                    selectable: true,
                    selected: false
                }
            ];
            }());
    </script>

@element uqlibrary-date-selector
@blurb Custom web element displays a provided date and time schedule with ability to select time slots
@status alpha
@homepage http://uqlibrary.github.io/uqlibrary-date-selector

-->
<polymer-element name="uqlibrary-date-selector" attributes="searchDate maxBookingDate bookingTimeslots">

  <template>

    <link rel="stylesheet" href="uqlibrary-date-selector.css">

    <div id="wrap" class="wrap">

      <paper-icon-button id="button-left" icon="chevron-left" on-click="{{ showPreviousDate }}"> </paper-icon-button>
      <div class="scroller">

        <ul class="items">

          <template repeat="{{date, index in dates}}">

              <li class="item {{ date | setCurrentClass }}" data-index="{{index}}">
                {{  date  | dayOfWeek  }},<br/>
                {{  date  | formatDate  }}

              </li>

          </template>

        </ul>

      </div>
      <paper-icon-button id="button-right" icon="chevron-right" on-click="{{ showNextDate }}"> </paper-icon-button>

    </div>

    <uqlibrary-time-selector id="timeSelector"></uqlibrary-time-selector>

  </template>


  <script>

    Polymer({
    /**
     * The `searchDate` attribute date for which display time slots
     *
     * @property searchDate
     * @type Date
     */

    /**
     * The `maxBookingDate` attribute date maximum possible booking date
     *
     * @property maxDate
     * @type Date
     */

     /**
      *  The `bookingTimeslots` attribute object containing time slots for searchDate
      *
      * @property bookingTimeslots
      * @type Object
      */

      setCurrentClass : function (date) {
        return date.toDateString() === this.searchDate.toDateString() ? 'selected' : '';
      },

      formatDate : function (date) {
        return '' + date.getDate() + " " + this.monthNames[date.getMonth()];
      },

      dayOfWeek : function (date) {
        return '' + this.dayNames[date.getDay()];
      },

      searchDateChanged : function (oldValue, newValue) {
        this.generateDates();

        //TODO: get timeslots for this date from...?

      },

      bookingTimeslotsChanged : function(oldValue, newValue){

        this.$.timeSelector.timeslots = this.bookingTimeslots;

      },

      created: function() {
        this.ticksPerDay = 24 * 60 * 60 * 1000;
        this.dayNames = [
          'Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'
        ];
        this.monthNames = [
          'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'
        ];

        this.searchDate = new Date();
        this.maxBookingDate = new Date(this.searchDate.getTime() + 7 * this.ticksPerDay);
        this.dates = [];
        this.bookingTimeslots = [];

        this.generateDates();
      },

      generateDates: function() {
        var today = new Date();

        var timeDiff = Math.abs(today.getTime() - this.maxBookingDate.getTime());
        var diffDays = Math.ceil(timeDiff / this.ticksPerDay);

        this.dates = [];

        for(var i=0; i < diffDays; i++) {
          this.dates.push(new Date(today.getTime() + i * this.ticksPerDay));
        }
      },

      showPreviousDate: function(event) {
        console.log('showPreviousDate TBA');
      },

      showNextDate: function(event) {
        console.log('showNextDate TBA');
      }

      /*

       getGesturePointFromEvent : function(evt) {
       var point = {};

       if(evt.targetTouches) {
       point.x = evt.targetTouches[0].clientX;
       point.y = evt.targetTouches[0].clientY;
       } else {
       // Either Mouse event or Pointer Event
       point.x = evt.clientX;
       point.y = evt.clientY;
       }

       return point;
       },

       slideTouch: function(evt) {

       var itemCount = this.timeslots.length;
       var scrolleWidth = this.$.wrap.querySelector('.scroller').clientWidth;

       if (!this.lastTimeScrollPosition)
       this.lastTimeScrollPosition = this.getGesturePointFromEvent(evt).x;

       //TODO: calculate scrolling position
       var delta = (this.getGesturePointFromEvent(evt).x - this.lastTimeScrollPosition);

       this.offset += delta;
       console.log('offset: ' + this.offset + ' delta:' + delta + " direction: touch");
       console.log('new x: ' + this.getGesturePointFromEvent(evt).x + ' old x:' + this.lastTimeScrollPosition);
       this.setTransform();

       //update last time scroll position
       this.lastTimeScrollPosition = this.getGesturePointFromEvent(evt).x;

       },

       slidePrevious: function(evt) {
       //TODO: calculate scrolling position
       var delta = 170;
       this.offset += delta;

       console.log('offset: ' + this.offset + ' delta:' + delta + " direction: previous");

       this.setTransform();
       },

       slideNext: function(evt) {
       //TODO: calculate scrolling position
       var delta = -170;
       this.offset += delta;

       console.log('offset: ' + this.offset + ' delta:' + delta + " direction: next");

       this.setTransform();
       },

       setTransform: function() {
       //TODO: check boundaries of .items vs .scroller not to scroll over

       //this.offset = this.offset > 0 ? 0 : this.offset;
       //this.offset = this.offset < -(this.$.wrap.querySelector('.items').clientWidth) ?  -this.$.wrap.querySelector('.items').clientWidth : this.offset;

       console.log('offset: ' + this.offset);

       //this.$.wrap.querySelector('.items').style[this.transform] = 'translate3d(' + (this.offset) + 'p x,0,0)';
       this.$.wrap.querySelector('.items').style.msTransform = 'translateX(' + (this.offset) + 'px)';
       this.$.wrap.querySelector('.items').style.webkitTransform = 'translateX(' + (this.offset) + 'px)';
       this.$.wrap.querySelector('.items').style.transform = 'translateX(' + (this.offset) + 'px)';
       this.$.wrap.querySelector('.items').style.MozTransform = 'translateX(' + (this.offset) + 'px)';

       }

      * */
    });

  </script>

</polymer-element>
